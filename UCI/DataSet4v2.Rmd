---
title: "DataSet4 - Ionosphere"
author: "Sungcheol Kim"
date: "12/19/2019"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(magrittr)
library(caret)
library(dplyr)
library(pander)
library(mlbench)

source('r_summa.R')
```

## Prepare Data

```{r}
data(Ionosphere)

df <- Ionosphere
df <- df[,-2]
df$V1 <- as.numeric(as.character(df$V1))
str(df)
```

```{r}
buildSummaModel <- function(iter, ml=modellist, df=df) {
  set.seed(iter)
  inTraining0 <- createDataPartition(df$Class, p = .75, list = FALSE)
  training <- df[ inTraining0, ]
  testing  <- df[-inTraining0, ]
  testingY <- df[-inTraining0, ncol(df)]
  
  temp <- summa(modellist) %>%
    train(Class~., training, update=F) %>%
    predict(newdata = testing, alpha=1, Y=testingY)

  saveRDS(temp, file=paste0("DS4_partition",iter,"_summa.RData"))
  temp
}
```

```{r}
modellist <- c('nnet', 'rda', 'pls', 'C5.0', 'ctree', 'gbm', 'avNNet', 'rpart', 'bayesglm') 

sss <- map(1:10, buildSummaModel, ml=modellist, df=df)
```

```{r}
plot(s1)
```

```{r}
summary(s1)
```


```{r}
generate_plot(sss, alpha=3, dataname = '4')
```

```{r}
generate_plot(sss, alpha=7, dataname = '4')
```

```{r}
alpha <- 1

res <- sss %>%
  map(predict, alpha=alpha) %>%
  map(summary.summa) %>%
  reduce(rbind)

res[res$model == 'summa', 'model'] <- 'summa+'
res
```

```{r}
ggplot(res, aes(x=ROC, y=l2, color=model)) + geom_point()
```

