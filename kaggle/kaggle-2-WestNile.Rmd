---
title: "kaggle"
author: "Sungcheol Kim"
date: "3/3/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(caret)
library(FiDEL)
```

## Train data

```{r}
train <- as.data.table(readr::read_csv('data/data-westnile.csv.bz2'))
train$y <- as.factor(train$y)
train <- train[, -c('X82', 'X84')]

head(train)
```

```{r}
table(train$y)
```

```{r}
folds <- createFolds(train$y, k=22, list = TRUE)
traininglist <- lapply(folds, function(x) train[x, ])
testing  <- traininglist[[22]]
testingY <- to_label(testing$y, class1='Yes')
```

```{r}
model_list <- c('rda', 'svmLinear', 'svmRadial', 'pls', 'knn', 'earth', 'avNNet', 'mlp', 'nb', 'rf', 'rpart', 'ctree', 'gbm', 'bayesglm', 'glm', 'glmnet', 'simpls', 'nnet', 'dwdRadial', 'xgbTree', 'xgbLinear')
# C5.0 - error on prediction
t1 <- mtrainer(model_list, dataInfo = 'WestNile')
```

```{r}
t1 <- train.mtrainer(t1, y~., traininglist, update=TRUE)
```
```{r}
#t1 <- addmodel.mtrainer(t1, c('dwdRadial', 'xgbTree', 'xgbLinear'))
```


```{r}
t1 <- predict.mtrainer(t1, newdata=testing)
auclist <- apply(t1$predictions, 2, auc_rank, testingY)
```

```{r}
fde1 <- fde(t1$predictions)
fde1 <- predict_performance(fde1, auclist, attr(testingY, 'rho'))
```
```{r}
fde2 <- calculate_performance(fde1, testingY)
```

```{r}
plot_cor(fde1, legend_flag = T)
```
```{r}
plot_cor(fde2, legend_flag=T)
```

```{r}
plot_performance(fde2, nmethod_list=c(5), nsample=200)
```

```{r}
plot_performance_nmethods(fde2, nmethod_list=3:10, nsample=200)
```

```{r}
plot_single(fde2, 'roc')
```

```{r}
plot_ensemble(fde2)
```

```{r}
plot_FDstatistics(fde2)
```

```{r}
#plot_single(fde1, 'score')
store.mtrainer(t1, 'westnile_pre.RData')
saveRDS(testingY, 'westnile_y.RData')
```



